<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Specify <code>tf.cond()</code> output structure when autographing <code>if</code> — ag_if_vars • tfautograph</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Specify <code>tf.cond()</code> output structure when autographing <code>if</code> — ag_if_vars" />
<meta property="og:description" content="This function can be used to specify the output structure from tf.cond()
when autographing an if statement. In most use cases, use of this function
is purely optional. If not supplied, the if output structure is
automatically built." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tfautograph</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tfautograph.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/hints.html">Giving hints</a>
    </li>
    <li>
      <a href="../articles/tf-v1.html">Control Dependencies in Tensorflow Version 1</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Demos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/demo-mnist.html">MNIST Training Loop</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/t-kalinowski/tfautograph">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Specify <code>tf.cond()</code> output structure when autographing <code>if</code></h1>
    <small class="dont-index">Source: <a href='https://github.com/t-kalinowski/tfautograph/blob/master/R/hints.R'><code>R/hints.R</code></a></small>
    <div class="hidden name"><code>ag_if_vars.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function can be used to specify the output structure from <code>tf.cond()</code>
when autographing an <code>if</code> statement. In most use cases, use of this function
is purely optional. If not supplied, the <code>if</code> output structure is
automatically built.</p>
    </div>

    <pre class="usage"><span class='fu'>ag_if_vars</span>(
  <span class='no'>...</span>,
  <span class='kw'>modified</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>return</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>undefs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>control_flow</span> <span class='kw'>=</span> <span class='fl'>0</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>...</th>
      <td><p>Variables modified by the <code>tf.cond()</code> node supplied as bare
symbols like <code>foo</code> or expressions using <code>$</code> e.g, <code>foo$bar</code>. Symbols do not
have to exist before the autographed <code>if</code> so long as they are created in
both branches.</p></td>
    </tr>
    <tr>
      <th>modified</th>
      <td><p>Variables names supplied as a character vector, or a list of
character vectors if specifying nested complex structures. This is an
escape hatch for the lazy evaluation semantics of <code>...</code></p></td>
    </tr>
    <tr>
      <th>return</th>
      <td><p>logical, whether to include the return value the evaluated R
expression in the <code>tf.cond()</code>. if <code>FALSE</code> (the default), only the objects
assigned in scope are captured.</p></td>
    </tr>
    <tr>
      <th>undefs</th>
      <td><p>A bare character vector or a list of character vectors.
Supplied names are exported as undefs in the parent frame. This is used to
give a more informative error message when attempting to access a variable
that can't be balanced between branches.</p></td>
    </tr>
    <tr>
      <th>control_flow</th>
      <td><p>An integer, the maximum number of control-flow statements
(<code>break</code> and/or <code>next</code>) that will be captured in a single branch as part of
the <code>tf.cond()</code>. Do not count statements in loops that are dispatching to
standard R control flow (e.g., don't count <code>break</code> statements in a <code>for</code>
loop that is iterating over an R vector)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>NULL</code>, invisibly</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If the output structure is not explicitly supplied via
<code>ag_if_vars()</code>, then the output structure is automatically composed: The
true and false branches of the expression are traced into concrete
functions, then the output signature from the two branch functions are
balanced. Balancing is performed by either fetching a variable from an
outer scope or by reclassifying a symbol as an undef.</p>
<p>When dealing with complex composites (that is, nested structures where a
modified tensor is part of a named list or dictionary), care is taken to
prevent unnecessarily capturing other unmodified tensors in the structure.
This is done by pruning unmodified tensors from the returned output
structure, and then merging them back with the original object recursively.
One limitation of the implementation is that lists must either be fully
named with unique names, or not named at all, partially named lists or
duplicated names in a list throw an error. This is due to the conversion
that happens when going between python and R: named lists get converted to
python dictionaries, which require that all keys are unique. Additionally,
pruning of unmodified objects from an autographed <code>if</code> is currently only
supported for named lists (python dictionaries). Unnamed lists or tuples
are passed as is (e.g, no pruning and merging done), which may lead to
unnecessarily bloat in the constructed graphs.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># these examples only have an effect in graph mode</span>
<span class='co'># to enter graph mode easily we'll create a few helpers</span>
<span class='no'>ag</span> <span class='kw'>&lt;-</span> <span class='no'>autograph</span>

<span class='co'># pass which symbols you expect to be modifed or created liks this:</span>
<span class='fu'>ag_if_vars</span>(<span class='no'>x</span>)
<span class='fu'>ag</span>(<span class='kw'>if</span> (<span class='no'>y</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>) {
  <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='no'>y</span> * <span class='no'>y</span>
} <span class='kw'>else</span> {
  <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='no'>y</span>
})

<span class='co'># if the return value from the if expression is important, pass `return = TRUE`</span>
<span class='fu'>ag_if_vars</span>(<span class='kw'>return</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>ag</span>(<span class='kw'>if</span>(<span class='no'>y</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>) <span class='no'>y</span> * <span class='no'>y</span> <span class='kw'>else</span> <span class='no'>y</span>)

<span class='co'># pass complex nested structures like this</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='fl'>2</span>)

<span class='fu'>ag_if_vars</span>(<span class='no'>x</span>$<span class='no'>a</span>)
<span class='fu'>ag</span>(<span class='kw'>if</span>(<span class='no'>y</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>) {
  <span class='no'>x</span>$<span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='no'>y</span>
})

<span class='co'># undefs are for mark branch-local variables</span>
<span class='fu'>ag_if_vars</span>(<span class='no'>y</span>, <span class='no'>x</span>$<span class='no'>a</span>, <span class='kw'>undef</span> <span class='kw'>=</span> <span class='st'>"tmp_local_var"</span>)
<span class='fu'>ag</span>(<span class='kw'>if</span>(<span class='no'>y</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>) {
  <span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>y</span> * <span class='fl'>100</span>
  <span class='no'>tmp_local_var</span> <span class='kw'>&lt;-</span> <span class='no'>y</span> + <span class='fl'>1</span>
  <span class='no'>x</span>$<span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='no'>tmp_local_var</span>
})

<span class='co'># supplying `undef` is not necessary, it exists purely as a way to supply a</span>
<span class='co'># guardrail for defensive programming and/or to improve code readability</span>

<span class='co'>## modified vars can be supplied in `...` or as a named arg.</span>
<span class='co'>## these paires of ag_if_vars() calls are equivalent</span>
<span class='fu'>ag_if_vars</span>(<span class='no'>y</span>, <span class='no'>x</span>$<span class='no'>a</span>)
<span class='fu'>ag_if_vars</span>(<span class='kw'>modified</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='st'>"y"</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"x"</span>, <span class='st'>"a"</span>)))

<span class='fu'>ag_if_vars</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='no'>z</span>)
<span class='fu'>ag_if_vars</span>(<span class='kw'>modified</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"x"</span>, <span class='st'>"y"</span>, <span class='st'>"z"</span>))


<span class='co'>## control flow</span>
<span class='co'># count number of odds between 0:10</span>
<span class='fu'>ag</span>({
  <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fl'>10</span>
  <span class='no'>count</span> <span class='kw'>&lt;-</span> <span class='fl'>0</span>
  <span class='kw'>while</span>(<span class='no'>x</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>) {
    <span class='fu'>ag_if_vars</span>(<span class='kw'>control_flow</span> <span class='kw'>=</span> <span class='fl'>1</span>)
    <span class='kw'>if</span>(<span class='no'>x</span> <span class='kw'>%%</span> <span class='fl'>2</span> <span class='kw'>==</span> <span class='fl'>0</span>)
      <span class='kw'>next</span>
    <span class='no'>count</span> <span class='kw'>&lt;-</span> <span class='no'>count</span> + <span class='fl'>1</span>
  }
})
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Tomasz Kalinowski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


